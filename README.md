# OpeningHoursParser

This is a very simplistic parser for string values according to the [OSM opening hours specification][opening-hours-specification].

It parses 144'477 (90%) of 161'268 unique test strings in non-strict mode. The remaining 16'791 are likely valid errors, spot checking shows that they have obvious issues. In strict mode further 19'377 fail (total 36168).

Deviations from the grammar as of [this version of the opening hours specification][opening-hours-grammar-specification] in all modes:

 * case insensitive
 * minutes in times optional
 * leading 0s in times optional
 * single 0 for minutes
 * unicode EN DASH character is allowed for hyphen

In non-strict mode the following further differences are allowed:

 * three-character weekday abbreviations
 * times extending in to the next day that are missing the extra 24 hours are corrected
 * AM and PM time specifications are allowed
 * holidays following weekdays
 * 24/7 rules with preceding selectors are corrected to 00:00-24:00 time spans
 
The most common error that currently will cause an OH string not to be parsed is the use of "." instead of ":" in time specifications.

Converting the data structures generated by parsing back to strings will result in correct data according to the specification.

## Usage

``` java
try {
	OpeningHoursParser parser = new OpeningHoursParser(
		new ByteArrayInputStream(line.getBytes()));
	ArrayList<Rule> rules = parser.rules(strict);
	// ...
} catch() {
	// ...
}
```

## Including in your project

You can either download the *jar* from GitHub or add the following to your *build.gradle* file(s):

``` groovy
repositories {
    maven {
    	jcenter()
    }
}
```

``` groovy
dependencies {
    compile "ch.poole:OpeningHoursParser:0.1.2"
}
```


[opening-hours-specification]: http://wiki.openstreetmap.org/wiki/Key:opening_hours/specification
[opening-hours-grammar-specification]: http://wiki.openstreetmap.org/w/index.php?title=Key:opening_hours/specification&oldid=1075290
